version: 2
jobs:
  build:
    docker:
      - image: yeongsheng/alpine-elixir-circleci:latest
      # - image: circleci/node:latest
      # - image: circleci/elixir:latest
      # - image: postgres:9.6.2
      #   environment:
      #     POSTGRES_DB: hello_phoenix_test
      #     POSTGRES_USER: postgres
      #     POSTGRES_PASSWORD: postgres

    working_directory: ~/hello_phoenix
    environment:
      # - PATH: "$HOME/.asdf/bin:$HOME/.asdf/shims:$PATH"
      - MIX_ENV: test
    #   - HOME: "/home/circleci"
    steps:
      #     name: Setting environment variables
      #     environment:
      #       HOME: /home/circleci/hello_phoenix
      #     command: checkout
      - checkout
      - run: mix local.hex --force
      - run: mix local.rebar --force
      - run: mix deps.get
      - run: mix ecto.create
      - run: mix ecto.migrate
      - run: mix espec

# machine:
  # environment:
  #   PATH: "$HOME/.asdf/bin:$HOME/.asdf/shims:$PATH"
#     MIX_ENV: test
#
# dependencies:
#   pre:
#     - if ! asdf | grep version; then git clone https://github.com/asdf-vm/asdf.git ~/.asdf; fi
#     - asdf plugin-add erlang https://github.com/asdf-vm/asdf-erlang.git || true
#     - asdf plugin-add elixir https://github.com/asdf-vm/asdf-elixir.git || true
#     - asdf install
#     - mix local.hex --force
#     - mix local.rebar --force
#   override:
#     - mix deps.get
#   cache_directories:
#     - ~/.asdf
#     - ~/.mix
#     - deps
#     - _build
#
# test:
#   override:
#     - mix ecto.create
#     - mix ecto.migrate
#     - mix espec
